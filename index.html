<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repton Student Portal</title>
    <style>
        :root { 
            --accent: #2ecc71; 
            --navy: #060e1b; 
            --glass: rgba(255, 255, 255, 0.08); 
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        
        /* CORRECTED HOUSE COLORS */
        body.house-new { --accent: #2ecc71; }      /* Green Tie */
        body.house-orchard { --accent: #ff0000; }   /* RED */
        body.house-latham { --accent: #3498db; }    /* Blue */
        body.house-foremarke { --accent: #e67e22; } /* Orange/Prep Red Mix */
        body.house-dahl { --accent: #9b59b6; }      /* Purple */
        body.house-jumeirah { --accent: #1abc9c; }  /* Teal */
        body.house-school { --accent: #f1c40f; }    /* Yellow/Gold */

        body { background: var(--navy); color: white; display: flex; flex-direction: column; align-items: center; padding: 20px; min-height: 100vh; transition: 0.5s ease; }

        #login-screen, #settings-screen { position: fixed; inset: 0; background: var(--navy); z-index: 2000; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(25px); }
        #settings-screen { display: none; overflow-y: auto; padding: 20px; }
        #hub-ui { display: none; width: 100%; max-width: 450px; animation: fadeIn 0.4s ease; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card { background: var(--glass); border-radius: 24px; padding: 25px; border: 1px solid rgba(255,255,255,0.08); margin-bottom: 15px; width: 100%; position: relative; border-bottom: 3px solid var(--accent); }
        input, select { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: white; width: 100%; padding: 14px; border-radius: 12px; outline: none; margin-bottom: 12px; font-size: 14px; }
        
        .btn { width: 100%; padding: 16px; border-radius: 16px; border: none; font-weight: 800; cursor: pointer; transition: 0.2s; }
        .btn-primary { background: var(--accent); color: var(--navy); }

        .day-btn { background: rgba(255,255,255,0.05); border: none; color: white; padding: 10px 15px; border-radius: 10px; cursor: pointer; font-size: 11px; margin-right: 5px; }
        .day-btn.active { background: var(--accent); color: var(--navy); font-weight: 800; }

        .progress-bar { background: rgba(255,255,255,0.05); height: 6px; border-radius: 10px; margin: 15px 0; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--accent); width: 0%; transition: 1s linear; }
        
        .tag { font-size: 10px; font-weight: 900; color: var(--accent); letter-spacing: 2px; text-transform: uppercase; margin-bottom: 5px; display: block; }
    </style>
</head>
<body id="app-body">

    <div id="login-screen">
        <div class="card" style="max-width: 350px; text-align: center;">
            <h2 style="color: var(--accent); margin-bottom: 5px;">REPTON DUBAI</h2>
            <p style="font-size: 9px; opacity: 0.5; margin-bottom: 25px;">PORTA VACAT CULPA</p>
            <input type="text" id="username" placeholder="Student Name">
            <select id="house-select" onchange="previewHouse(this.value)">
                <option value="new">New House (Green Tie)</option>
                <option value="orchard">Orchard House (Red)</option>
                <option value="latham">Latham (Blue)</option>
                <option value="foremarke">Foremarke (Orange)</option>
                <option value="dahl">Dahl (Purple)</option>
                <option value="jumeirah">Jumeirah (Teal)</option>
                <option value="school">School (Yellow)</option>
            </select>
            <button class="btn btn-primary" onclick="handleLogin()">ACCESS HUB</button>
        </div>
    </div>

    <div id="settings-screen">
        <div class="card" style="max-width: 400px;">
            <h3>User Settings</h3>
            <p style="font-size: 11px; opacity: 0.5; margin-bottom: 10px;">Switch House</p>
            <select id="house-switch" onchange="previewHouse(this.value)">
                <option value="new">New House</option>
                <option value="orchard">Orchard House</option>
                <option value="latham">Latham</option>
                <option value="foremarke">Foremarke</option>
                <option value="dahl">Dahl</option>
                <option value="jumeirah">Jumeirah</option>
                <option value="school">School House</option>
            </select>

            <div style="margin: 15px 0;">
                <button class="day-btn active" onclick="changeDay(1)">Mon</button>
                <button class="day-btn" onclick="changeDay(2)">Tue</button>
                <button class="day-btn" onclick="changeDay(3)">Wed</button>
                <button class="day-btn" onclick="changeDay(4)">Thu</button>
                <button class="day-btn" onclick="changeDay(5)">Fri</button>
            </div>
            <div id="editor-grid" style="max-height: 40vh; overflow-y: auto;"></div>
            <button class="btn btn-primary" style="margin-top: 15px;" onclick="saveAll()">SAVE & CLOSE</button>
        </div>
    </div>

    <div id="hub-ui">
        <div style="display: flex; justify-content: space-between; font-size: 11px; opacity: 0.5; margin-bottom: 10px; font-weight: bold;">
            <span id="clock">00:00</span>
            <span id="bat">--% üîã</span>
        </div>

        <div class="card">
            <span class="tag" id="house-tag">HOUSE</span>
            <div style="display: flex; justify-content: space-between; align-items: baseline;">
                <h2 id="greet" style="font-size: 20px;">--</h2>
                <span onclick="openSettings()" style="cursor:pointer; opacity: 0.3; font-size: 18px;">‚öôÔ∏è</span>
            </div>
            
            <div style="margin-top: 25px;">
                <span id="date-label" style="font-size: 10px; opacity: 0.5; font-weight: 900;">DAY</span>
                <div id="cur-lesson" style="font-size: 30px; font-weight: 800; margin: 5px 0;">--</div>
                <div id="timer" style="font-size: 11px; font-weight: 700; opacity: 0.4;">READY</div>
            </div>

            <div class="progress-bar"><div id="bar" class="progress-fill"></div></div>
        </div>

        <div class="card" style="padding: 15px; text-align: center;">
            <span id="w-temp" style="font-size: 22px; font-weight: 800;">--¬∞C</span>
            <p style="font-size: 9px; opacity: 0.5; font-weight: bold; margin-top: 5px;">NAD AL SHEBA</p>
        </div>
    </div>

    <script>
        let userData = { name: "", house: "new", schedule: {1:[], 2:[], 3:[], 4:[], 5:[]} };
        let activeEditDay = 1;

        const standardSlots = [
            { s: "07:40", e: "08:00", label: "Registration" },
            { s: "08:00", e: "09:00", label: "Lesson 1" },
            { s: "09:00", e: "10:00", label: "Lesson 2" },
            { s: "10:00", e: "10:20", label: "BREAK" },
            { s: "10:20", e: "11:20", label: "Lesson 3" },
            { s: "11:20", e: "12:20", label: "Lesson 4" },
            { s: "12:20", e: "13:00", label: "LUNCH" },
            { s: "13:00", e: "14:00", label: "Lesson 5" },
            { s: "14:00", e: "15:00", label: "Lesson 6" }
        ];

        const fridaySlots = [
            { s: "07:40", e: "08:00", label: "Registration" },
            { s: "08:00", e: "09:00", label: "Lesson 1" },
            { s: "09:00", e: "10:00", label: "Lesson 2" },
            { s: "10:00", e: "10:20", label: "BREAK" },
            { s: "10:20", e: "11:20", label: "Lesson 3" },
            { s: "11:20", e: "11:30", label: "Final Wrap" }
        ];

        function previewHouse(h) { document.body.className = `house-${h}`; }

        function handleLogin() {
            const name = document.getElementById('username').value.trim();
            const house = document.getElementById('house-select').value;
            if(!name) return;

            const saved = localStorage.getItem(`repton_v9_${name}`);
            userData = saved ? JSON.parse(saved) : { name, house, schedule: {1:[], 2:[], 3:[], 4:[], 5:[]} };
            
            saveToStorage();
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('hub-ui').style.display = 'block';
            document.getElementById('house-tag').innerText = `${userData.house} House`;
            document.body.className = `house-${userData.house}`;
            start();
        }

        function openSettings() { 
            document.getElementById('house-switch').value = userData.house;
            renderEditor(); 
            document.getElementById('settings-screen').style.display = 'flex'; 
        }

        function changeDay(d) { saveInputs(); activeEditDay = d; document.querySelectorAll('.day-btn').forEach((b, i) => b.classList.toggle('active', i+1 === d)); renderEditor(); }

        function renderEditor() {
            const grid = document.getElementById('editor-grid');
            const isFri = activeEditDay === 5;
            const activeSlots = isFri ? fridaySlots : standardSlots;
            const data = userData.schedule[activeEditDay] || [];
            grid.innerHTML = activeSlots.map((slot, i) => `
                <div style="display:flex; align-items:center; gap:10px; margin-bottom:8px;">
                    <span style="font-size:10px; width:60px; opacity:0.3; font-weight:bold;">${slot.s}</span>
                    <input class="tt-edit-input" value="${data[i] || ''}" placeholder="${slot.label}">
                </div>
            `).join('');
        }

        function saveInputs() {
            const inputs = document.querySelectorAll('.tt-edit-input');
            if(inputs.length) userData.schedule[activeEditDay] = Array.from(inputs).map(i => i.value);
        }

        function saveAll() { 
            saveInputs(); 
            userData.house = document.getElementById('house-switch').value;
            document.getElementById('house-tag').innerText = `${userData.house} House`;
            saveToStorage(); 
            document.getElementById('settings-screen').style.display = 'none'; 
            tick(); 
        }

        function saveToStorage() { localStorage.setItem(`repton_v9_${userData.name}`, JSON.stringify(userData)); localStorage.setItem('last_v9', userData.name); }

        function tick() {
            const now = new Date();
            const day = now.getDay();
            const mins = now.getHours() * 60 + now.getMinutes();
            document.getElementById('clock').innerText = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
            document.getElementById('date-label').innerText = ["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"][day];
            document.getElementById('greet').innerText = `Hello, ${userData.name.split(' ')[0]}`;

            let lesson = "Day Over", prog = 0, msg = "OFF-DUTY";
            if(day >= 1 && day <= 5) {
                const currentDaySlots = (day === 5) ? fridaySlots : standardSlots;
                const schoolEndMins = (day === 5) ? 690 : 900; 

                currentDaySlots.forEach((slot, i) => {
                    const sM = parseInt(slot.s.split(':')[0])*60 + parseInt(slot.s.split(':')[1]);
                    const eM = parseInt(slot.e.split(':')[0])*60 + parseInt(slot.e.split(':')[1]);
                    if(mins >= sM && mins < eM) {
                        lesson = userData.schedule[day][i] || slot.label;
                        prog = ((mins - sM) / (eM - sM)) * 100;
                        msg = `${eM - mins}m REMAINING`;
                    }
                });
                if(mins >= schoolEndMins) { lesson = "School's Out"; msg = "WEEKEND"; }
            }
            document.getElementById('cur-lesson').innerText = lesson;
            document.getElementById('bar').style.width = prog + "%";
            document.getElementById('timer').innerText = (day === 0 || day === 6) ? "WEEKEND MODE" : msg;
        }

        async function start() {
            setInterval(tick, 1000); tick();
            try {
                const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=25.14&longitude=55.37&current=temperature_2m&timezone=auto');
                const d = await res.json();
                document.getElementById('w-temp').innerText = Math.round(d.current.temperature_2m) + "¬∞C";
            } catch(e) {}
            if(navigator.getBattery) {
                const b = await navigator.getBattery();
                const u = () => document.getElementById('bat').innerText = `${Math.round(b.level * 100)}% ${b.charging ? '‚ö°' : 'üîã'}`;
                u(); b.onlevelchange = u; b.onchargingchange = u;
            }
        }

        window.onload = () => {
            const last = localStorage.getItem('last_v9');
            if(last) {
                const saved = localStorage.getItem(`repton_v9_${last}`);
                if(saved) { userData = JSON.parse(saved); handleLogin(); }
            }
        }
    </script>
</body>
</html>
