<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repton Pro Hub - Shared</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --glass: rgba(255, 255, 255, 0.1); --accent: #ffcc00; --navy: #1d427b; --warn: #ff4444; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif; }
        body { background: #0a192f; color: white; display: flex; flex-direction: column; align-items: center; padding: 15px; }
        
        /* Shared CSS from previous versions... */
        #login-screen { position: fixed; inset: 0; background: #0a192f; z-index: 1000; display: flex; align-items: center; justify-content: center; }
        .login-box { background: var(--glass); backdrop-filter: blur(20px); padding: 40px; border-radius: 30px; text-align: center; width: 350px; border: 1px solid rgba(255,255,255,0.1); }
        .pin-input { background: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); border-radius: 15px; padding: 15px; color: white; font-size: 24px; text-align: center; width: 100%; margin: 20px 0; }
        
        .card { background: var(--glass); backdrop-filter: blur(25px); border-radius: 28px; padding: 22px; width: 100%; max-width: 380px; border: 1px solid rgba(255,255,255,0.15); margin-top: 10px; }
        .main-btn { width: 100%; max-width: 380px; padding: 16px; border-radius: 20px; border: none; background: white; color: var(--navy); font-weight: 800; cursor: pointer; margin-top: 12px; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; z-index: 100; padding: 20px; align-items: center; justify-content: center; }
        .modal-box { background: #111; width: 100%; max-width: 400px; border-radius: 30px; padding: 25px; border: 1px solid #333; }
        input { background: #222; border: 1px solid #444; color: white; padding: 8px; border-radius: 8px; width: 100%; }
        .p-bar { height: 6px; width: 0%; background: var(--accent); border-radius: 10px; transition: 0.5s; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h2 style="color:var(--accent)">REPTON HUB</h2>
            <input type="password" id="pinInput" class="pin-input" maxlength="4" placeholder="â€¢â€¢â€¢â€¢">
            <button class="main-btn" onclick="checkPin()">UNLOCK HUB</button>
        </div>
    </div>

    <div id="hub-content" style="display:none; width: 100%; max-width: 380px;">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h1 id="greet">Hello</h1>
            <span id="bat-stat" style="font-size: 12px; opacity:0.5;">--% ðŸ”‹</span>
        </div>

        <div class="card">
            <div id="status" style="font-size: 22px; font-weight: 800;">Loading Hub...</div>
            <div style="background:rgba(255,255,255,0.1); height:6px; border-radius:10px; margin: 15px 0;">
                <div id="bar" class="p-bar"></div>
            </div>
            <div id="weather" style="opacity:0.8">Dubai: --Â°C</div>
        </div>

        <button class="main-btn" onclick="openPop('ttM')">VIEW SHARED TIMETABLE</button>
        <button class="main-btn" style="background:transparent; color:white; border:1px solid rgba(255,255,255,0.2)" onclick="logout()">LOGOUT</button>
    </div>

    <div id="ttM" class="modal" onclick="if(event.target==this)this.style.display='none'">
        <div class="modal-box">
            <h3 style="margin-bottom:15px">Global Timetable</h3>
            <div id="ttList" style="max-height: 300px; overflow-y: auto;"></div>
            <button class="main-btn" onclick="saveGlobalData()">SAVE FOR EVERYONE</button>
            <button class="main-btn" style="background:#333; color:white;" onclick="closePop('ttM')">Close</button>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const SB_URL = "https://dcmyqxrxwkhdikgwgqzv.supabase.co";
        const SB_KEY = "sb_publishable_Q6z4YJIMySzvu1yNVBiiXA_OgyUwAWG";
        const supabase = lib.supabase.createClient(SB_URL, SB_KEY);

        let globalStore = { pin: "1234", timetable: [], lunch: {} };

        // 1. Fetch Shared Data from Cloud
        async function loadCloudData() {
            const { data, error } = await supabase.from('hub_data').select('content').eq('id', 'main_config').single();
            if (data) globalStore = data.content;
        }

        // 2. Save Shared Data to Cloud
        async function saveGlobalData() {
            // Collect data from inputs (Simplified for example)
            const { error } = await supabase.from('hub_data').update({ content: globalStore }).eq('id', 'main_config');
            if (!error) alert("Saved for all users!");
        }

        function checkPin() {
            const val = document.getElementById('pinInput').value;
            if(val === globalStore.pin) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('hub-content').style.display = 'block';
                startHub();
            } else {
                alert("Wrong PIN");
            }
        }

        function logout() { location.reload(); }
        const openPop = (id) => document.getElementById(id).style.display='flex';
        const closePop = (id) => document.getElementById(id).style.display='none';

        function startHub() {
            setInterval(() => {
                const now = new Date();
                document.getElementById('greet').innerText = now.getHours() < 12 ? "Good Morning!" : "Good Day!";
            }, 1000);
        }

        // Initialize
        loadCloudData();
    </script>
</body>
</html>
