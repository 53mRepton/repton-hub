<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repton Pro Hub - Multi-Day</title>
    <style>
        :root { --glass: rgba(255, 255, 255, 0.1); --accent: #ffcc00; --navy: #0a192f; --warn: #ff4444; --green: #2ecc71; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; }
        body { background: var(--navy); color: white; min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 15px; }

        /* Screens */
        #login-screen, #settings-screen { position: fixed; inset: 0; background: var(--navy); z-index: 1000; display: flex; align-items: center; justify-content: center; }
        #settings-screen { display: none; overflow-y: auto; padding: 20px; z-index: 900; background: rgba(10, 25, 47, 0.98); }
        #hub-ui { display: none; width: 100%; max-width: 450px; animation: fadeIn 0.5s ease; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Cards & UI */
        .card { background: var(--glass); backdrop-filter: blur(20px); border-radius: 25px; padding: 22px; border: 1px solid rgba(255,255,255,0.15); margin-bottom: 15px; position: relative; }
        .status-bar { display: flex; justify-content: space-between; font-size: 11px; font-weight: 900; opacity: 0.6; margin-bottom: 8px; letter-spacing: 1px; width: 100%; }
        
        /* Day Selector Tabs */
        .day-tabs { display: flex; gap: 5px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px; }
        .day-btn { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 8px 12px; border-radius: 10px; cursor: pointer; font-size: 12px; }
        .day-btn.active { background: var(--accent); color: var(--navy); font-weight: bold; }

        /* Weather Items */
        .weather-grid-hourly { display: flex; overflow-x: auto; gap: 15px; padding-bottom: 10px; scrollbar-width: none; }
        .hourly-item { text-align: center; min-width: 50px; font-size: 11px; }
        .hourly-item img { width: 30px; }

        /* Forms */
        .tt-input { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: white; width: 100%; padding: 10px; border-radius: 8px; outline: none; margin: 2px 0; }
        .btn { width: 100%; padding: 16px; border-radius: 18px; border: none; font-weight: 800; cursor: pointer; transition: 0.2s; }
        .btn-primary { background: var(--accent); color: var(--navy); }
        .btn-ghost { background: transparent; color: white; border: 1px solid rgba(255,255,255,0.2); }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="card" style="width: 320px; text-align: center;">
            <h1 style="color: var(--accent);">REPTON PRO</h1>
            <input type="text" id="nameInput" placeholder="User Name" style="width:100%; padding:15px; margin:20px 0; border-radius:12px; border:none; text-align:center;">
            <button class="btn btn-primary" onclick="login()">ENTER</button>
        </div>
    </div>

    <div id="settings-screen">
        <div class="card" style="width: 100%; max-width: 400px;">
            <h2 style="margin-bottom: 10px;">Edit Weekly Schedule</h2>
            <div class="day-tabs" id="settings-days">
                <button class="day-btn active" onclick="changeEditDay(1)">Mon</button>
                <button class="day-btn" onclick="changeEditDay(2)">Tue</button>
                <button class="day-btn" onclick="changeEditDay(3)">Wed</button>
                <button class="day-btn" onclick="changeEditDay(4)">Thu</button>
                <button class="day-btn" onclick="changeEditDay(5)">Fri</button>
            </div>
            <div id="settings-inputs"></div>
            <button class="btn btn-primary" style="background: var(--green); margin-top: 15px;" onclick="saveWeeklyData()">SAVE ALL DAYS</button>
            <button class="btn btn-ghost" style="margin-top: 10px;" onclick="closeSettings()">CLOSE</button>
        </div>
    </div>

    <div id="hub-ui">
        <div class="status-bar"><span id="clock">00:00:00</span><span id="bat">--% üîã</span></div>

        <div class="card">
            <div id="day-display" style="font-size: 10px; font-weight: 900; color: var(--accent); margin-bottom: 5px;">MONDAY</div>
            <h2 id="greet">Hello</h2>
            <div id="current-lesson" style="font-size: 26px; font-weight: 800; margin: 5px 0;">...</div>
            <div id="countdown" style="font-size: 11px; font-weight: 900; opacity: 0.6;">...</div>
            <div style="background:rgba(255,255,255,0.1); height:6px; border-radius:10px; margin:15px 0; overflow:hidden;">
                <div id="bar" style="height:100%; background:var(--accent); width:0%;"></div>
            </div>
            <button class="btn btn-ghost" style="padding: 8px; font-size: 11px;" onclick="openSettings()">‚öôÔ∏è CONFIGURE WEEKLY SCHEDULE</button>
        </div>

        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div id="w-temp" style="font-size: 32px; font-weight: 800;">--¬∞C</div>
                <img id="w-icon-main" src="" style="width:50px;">
            </div>
            <div class="weather-grid-hourly" id="hourly-forecast"></div>
        </div>
    </div>

    <script>
        let user = "";
        let currentEditDay = 1; // Monday
        const weekDays = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
        const times = ["08:00", "09:00", "10:00", "11:00", "11:20", "12:20", "13:20", "14:00", "15:00"];
        const endTimes = ["09:00", "10:00", "11:00", "11:20", "12:20", "13:20", "14:00", "15:00", "16:00"];

        // Default schedule if none exists
        let masterSchedule = {
            1: ["Maths", "English", "Science", "Break", "History", "Arabic", "Lunch", "PE", "ICT"],
            2: ["English", "Maths", "ICT", "Break", "Science", "History", "Lunch", "Arabic", "PE"],
            3: ["Science", "ICT", "Maths", "Break", "PE", "English", "Lunch", "History", "Arabic"],
            4: ["Arabic", "Science", "English", "Break", "ICT", "Maths", "Lunch", "PE", "History"],
            5: ["History", "PE", "Arabic", "Break", "English", "Science", "Lunch", "ICT", "Maths"]
        };

        function login() {
            user = document.getElementById('nameInput').value.trim();
            if(!user) return;
            localStorage.setItem('repton_last_user', user);
            const saved = localStorage.getItem(`weekly_tt_${user}`);
            if(saved) masterSchedule = JSON.parse(saved);
            
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('hub-ui').style.display = 'block';
            startAll();
        }

        function openSettings() {
            renderSettingsInputs();
            document.getElementById('settings-screen').style.display = 'flex';
        }

        function changeEditDay(dayNum) {
            // Save current inputs before switching
            const inputs = document.querySelectorAll('.tt-input');
            masterSchedule[currentEditDay] = Array.from(inputs).map(i => i.value);
            
            currentEditDay = dayNum;
            document.querySelectorAll('#settings-days .day-btn').forEach((btn, idx) => {
                btn.classList.toggle('active', (idx + 1) === dayNum);
            });
            renderSettingsInputs();
        }

        function renderSettingsInputs() {
            const container = document.getElementById('settings-inputs');
            const dayData = masterSchedule[currentEditDay] || Array(9).fill("");
            container.innerHTML = dayData.map((s, i) => `
                <div style="display:flex; align-items:center; gap:10px;">
                    <span style="font-size:10px; width:40px; opacity:0.5;">${times[i]}</span>
                    <input class="tt-input" value="${s}">
                </div>
            `).join('');
        }

        function saveWeeklyData() {
            // Final save of the currently open tab
            const inputs = document.querySelectorAll('.tt-input');
            masterSchedule[currentEditDay] = Array.from(inputs).map(i => i.value);
            
            localStorage.setItem(`weekly_tt_${user}`, JSON.stringify(masterSchedule));
            closeSettings();
            tick(); // Refresh UI
        }

        function closeSettings() { document.getElementById('settings-screen').style.display = 'none'; }

        function tick() {
            const now = new Date();
            const dayNum = now.getDay(); // 0-6
            const hour = now.getHours();
            const nowMins = hour * 60 + now.getMinutes();

            document.getElementById('clock').innerText = now.toLocaleTimeString();
            document.getElementById('day-display').innerText = weekDays[dayNum].toUpperCase();

            // Greeting
            let greet = (hour < 12) ? "Good Morning" : (hour < 17) ? "Good Afternoon" : "Good Evening";
            document.getElementById('greet').innerText = (dayNum === 0 || dayNum === 6) ? `Happy Weekend, ${user}! üèñÔ∏è` : `${greet}, ${user}!`;

            // Schedule logic
            let todaySchedule = masterSchedule[dayNum] || [];
            let current = "School's Out ‚ú®", progress = 0, countdown = "SEE YOU TOMORROW";

            if (dayNum >= 1 && dayNum <= 5) {
                todaySchedule.forEach((s, i) => {
                    const start = parseInt(times[i].split(':')[0])*60 + parseInt(times[i].split(':')[1]);
                    const end = parseInt(endTimes[i].split(':')[0])*60 + parseInt(endTimes[i].split(':')[1]);
                    if(nowMins >= start && nowMins < end) {
                        current = s;
                        progress = ((nowMins - start) / (end - start)) * 100;
                        countdown = `${end - nowMins} MINS REMAINING`;
                    }
                });
            }

            document.getElementById('current-lesson').innerText = current;
            document.getElementById('bar').style.width = progress + "%";
            document.getElementById('countdown').innerText = countdown;
        }

        async function startAll() {
            setInterval(tick, 1000);
            tick();
            fetchWeather();
            if(navigator.getBattery) {
                const b = await navigator.getBattery();
                const u = () => document.getElementById('bat').innerText = `${Math.round(b.level * 100)}% ${b.charging ? '‚ö°' : 'üîã'}`;
                u(); b.onlevelchange = u; b.onchargingchange = u;
            }
        }

        async function fetchWeather() {
            try {
                const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=25.14&longitude=55.37&current=temperature_2m,weather_code&hourly=temperature_2m,weather_code&timezone=auto');
                const d = await res.json();
                const getIco = (c) => `https://openweathermap.org/img/wn/${c <= 3 ? "01d" : c <= 67 ? "09d" : "03d"}.png`;
                
                document.getElementById('w-temp').innerText = `${Math.round(d.current.temperature_2m)}¬∞C`;
                document.getElementById('w-icon-main').src = getIco(d.current.weather_code);
                
                document.getElementById('hourly-forecast').innerHTML = d.hourly.time.slice(0, 12).map((t, i) => `
                    <div class="hourly-item">
                        <div>${t.split('T')[1]}</div>
                        <img src="${getIco(d.hourly.weather_code[i])}">
                        <div>${Math.round(d.hourly.temperature_2m[i])}¬∞</div>
                    </div>
                `).join('');
            } catch(e) {}
        }

        window.onload = () => {
            const last = localStorage.getItem('repton_last_user');
            if(last) { document.getElementById('nameInput').value = last; login(); }
        }
    </script>
</body>
</html>
