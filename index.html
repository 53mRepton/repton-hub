<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repton Pro Hub - Secure Login</title>
    <style>
        :root { --glass: rgba(255, 255, 255, 0.1); --accent: #ffcc00; --navy: #0a192f; --warn: #ff4444; --green: #2ecc71; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; }
        
        body { 
            background: var(--navy); 
            color: white; 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 15px;
            /* Simple animated background */
            background: radial-gradient(circle at top right, #1a3060, #0a192f);
        }

        /* Login Screen Overlay */
        #login-screen { 
            position: fixed; 
            inset: 0; 
            background: rgba(10, 25, 47, 0.8); 
            backdrop-filter: blur(15px);
            z-index: 2000; 
            display: flex; 
            align-items: center; 
            justify-content: center;
        }

        .login-card {
            background: var(--glass);
            padding: 40px;
            border-radius: 30px;
            border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
            width: 350px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }

        /* Dashboard UI (Hidden by default) */
        #hub-ui { display: none; width: 100%; max-width: 450px; animation: fadeIn 0.6s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Settings Modal */
        #settings-screen { display: none; position: fixed; inset: 0; background: var(--navy); z-index: 1500; padding: 20px; overflow-y: auto; }

        /* Styling Components */
        .card { background: var(--glass); backdrop-filter: blur(20px); border-radius: 25px; padding: 22px; border: 1px solid rgba(255,255,255,0.15); margin-bottom: 15px; }
        .status-bar { display: flex; justify-content: space-between; font-size: 11px; font-weight: 900; opacity: 0.6; margin-bottom: 10px; width: 100%; }
        
        .day-tabs { display: flex; gap: 8px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px; }
        .day-btn { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 8px 15px; border-radius: 12px; cursor: pointer; font-size: 12px; white-space: nowrap; }
        .day-btn.active { background: var(--accent); color: var(--navy); font-weight: bold; }

        input { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: white; width: 100%; padding: 15px; border-radius: 12px; outline: none; margin-bottom: 15px; font-size: 16px; text-align: center; }
        input:focus { border-color: var(--accent); }

        .btn { width: 100%; padding: 16px; border-radius: 18px; border: none; font-weight: 800; cursor: pointer; transition: 0.3s; font-size: 14px; }
        .btn-primary { background: var(--accent); color: var(--navy); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255, 204, 0, 0.3); }
        .btn-ghost { background: transparent; color: white; border: 1px solid rgba(255,255,255,0.2); }
        
        .weather-grid { display: flex; overflow-x: auto; gap: 15px; padding-bottom: 10px; }
        .hourly-item { text-align: center; min-width: 55px; font-size: 11px; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-card">
            <h1 style="color: var(--accent); letter-spacing: 3px; margin-bottom: 5px;">REPTON PRO</h1>
            <p style="font-size: 10px; opacity: 0.5; margin-bottom: 30px; font-weight: 900;">SECURE STUDENT HUB</p>
            <input type="text" id="loginUser" placeholder="Enter Your Name" autocomplete="off">
            <button class="btn btn-primary" onclick="handleLogin()">LOGIN TO HUB</button>
        </div>
    </div>

    <div id="settings-screen">
        <div class="card" style="max-width: 400px; margin: auto;">
            <h2 style="margin-bottom: 15px;">Weekly Schedule</h2>
            <div class="day-tabs">
                <button class="day-btn active" onclick="setEditDay(1, this)">Mon</button>
                <button class="day-btn" onclick="setEditDay(2, this)">Tue</button>
                <button class="day-btn" onclick="setEditDay(3, this)">Wed</button>
                <button class="day-btn" onclick="setEditDay(4, this)">Thu</button>
                <button class="day-btn" onclick="setEditDay(5, this)">Fri</button>
            </div>
            <div id="tt-editor"></div>
            <button class="btn btn-primary" style="background: var(--green); margin-top: 20px;" onclick="saveWeekly()">SAVE ALL CHANGES</button>
            <button class="btn btn-ghost" style="margin-top: 10px;" onclick="closeSettings()">CANCEL</button>
        </div>
    </div>

    <div id="hub-ui">
        <div class="status-bar">
            <span id="clock">00:00:00</span>
            <span id="bat">--% üîã</span>
        </div>

        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div>
                    <div id="today-label" style="font-size: 10px; font-weight: 900; color: var(--accent); letter-spacing: 1px;">MONDAY</div>
                    <h2 id="greet">Hello</h2>
                </div>
                <button onclick="logout()" style="background: none; border: none; color: var(--warn); font-size: 10px; font-weight: 900; cursor: pointer; opacity: 0.6;">LOGOUT</button>
            </div>
            
            <div id="current-lesson" style="font-size: 28px; font-weight: 800; margin: 10px 0;">Relaxing...</div>
            <div id="countdown" style="font-size: 11px; font-weight: 900; opacity: 0.5;">NO LESSONS ACTIVE</div>
            
            <div style="background:rgba(255,255,255,0.1); height:8px; border-radius:10px; margin:18px 0; overflow:hidden;">
                <div id="bar" style="height:100%; background:var(--accent); width:0%; transition: 1s linear;"></div>
            </div>
            <button class="btn btn-ghost" style="padding: 10px; font-size: 11px;" onclick="openSettings()">‚öôÔ∏è EDIT WEEKLY SCHEDULE</button>
        </div>

        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 15px;">
                <div>
                    <div id="w-temp" style="font-size: 36px; font-weight: 800;">--¬∞C</div>
                    <div id="w-desc" style="font-size: 12px; opacity: 0.6;">Dubai, UAE</div>
                </div>
                <img id="w-icon" src="" style="width:60px;">
            </div>
            <div class="weather-grid" id="hourly"></div>
        </div>
    </div>

    <script>
        let currentUser = "";
        let editDay = 1;
        const times = ["08:00", "09:00", "10:00", "10:20", "11:20", "12:20", "13:00", "14:00", "15:15"];
        const endTimes = ["09:00", "10:00", "10:20", "11:20", "12:20", "13:00", "14:00", "15:00", "16:00"];
        
        let masterSchedule = {
            1: ["Maths", "English", "Science", "Break", "History", "Arabic", "Lunch", "PE", "ECA"],
            2: ["English", "Maths", "ICT", "Break", "Science", "History", "Lunch", "Arabic", "ECA"],
            3: ["Science", "ICT", "Maths", "Break", "PE", "English", "Lunch", "History", "ECA"],
            4: ["Arabic", "Science", "English", "Break", "ICT", "Maths", "Lunch", "PE", "ECA"],
            5: ["History", "PE", "Arabic", "Break", "English", "Science", "", "", ""]
        };

        // --- Auth Logic ---
        function checkAuth() {
            const savedUser = localStorage.getItem('repton_session');
            if (savedUser) {
                currentUser = savedUser;
                const savedData = localStorage.getItem(`tt_data_${currentUser}`);
                if (savedData) masterSchedule = JSON.parse(savedData);
                
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('hub-ui').style.display = 'block';
                initHub();
            }
        }

        function handleLogin() {
            const name = document.getElementById('loginUser').value.trim();
            if (!name) return alert("Please enter your name");
            
            currentUser = name;
            localStorage.setItem('repton_session', name);
            checkAuth();
        }

        function logout() {
            localStorage.removeItem('repton_session');
            location.reload();
        }

        // --- Settings Logic ---
        function openSettings() {
            renderEditor();
            document.getElementById('settings-screen').style.display = 'block';
        }

        function closeSettings() { document.getElementById('settings-screen').style.display = 'none'; }

        function setEditDay(d, btn) {
            // Save current fields to memory first
            const inputs = document.querySelectorAll('.edit-input');
            masterSchedule[editDay] = Array.from(inputs).map(i => i.value);
            
            editDay = d;
            document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderEditor();
        }

        function renderEditor() {
            const container = document.getElementById('tt-editor');
            const data = masterSchedule[editDay] || Array(9).fill("");
            container.innerHTML = data.map((s, i) => `
                <div style="display:flex; align-items:center; gap:10px; margin-bottom:5px;">
                    <span style="font-size:10px; width:40px; opacity:0.4;">${times[i]}</span>
                    <input class="edit-input" value="${s}" style="margin:0; padding:10px; font-size:14px;">
                </div>
            `).join('');
        }

        function saveWeekly() {
            const inputs = document.querySelectorAll('.edit-input');
            masterSchedule[editDay] = Array.from(inputs).map(i => i.value);
            localStorage.setItem(`tt_data_${currentUser}`, JSON.stringify(masterSchedule));
            closeSettings();
            tick();
        }

        // --- Dashboard Logic ---
        function tick() {
            const now = new Date();
            const day = now.getDay();
            const hour = now.getHours();
            const mins = hour * 60 + now.getMinutes();
            
            document.getElementById('clock').innerText = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', second:'2-digit'});
            document.getElementById('today-label').innerText = ["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"][day];

            // Greeting
            let greetText = (hour < 12) ? "Good Morning" : (hour < 17) ? "Good Afternoon" : "Good Evening";
            if (day === 0 || day === 6) greetText = "Happy Weekend";
            document.getElementById('greet').innerText = `${greetText}, ${currentUser}!`;

            // Schedule
            let cur = "School's Out ‚ú®", prog = 0, count = "SEE YOU TOMORROW";
            if (masterSchedule[day]) {
                masterSchedule[day].forEach((s, i) => {
                    const sMin = parseInt(times[i].split(':')[0])*60 + parseInt(times[i].split(':')[1]);
                    const eMin = parseInt(endTimes[i].split(':')[0])*60 + parseInt(endTimes[i].split(':')[1]);
                    if (mins >= sMin && mins < eMin) {
                        cur = s;
                        prog = ((mins - sMin) / (eMin - sMin)) * 100;
                        count = `${eMin - mins} MINS REMAINING`;
                    }
                });
            }
            document.getElementById('current-lesson').innerText = cur;
            document.getElementById('bar').style.width = prog + "%";
            document.getElementById('countdown').innerText = count;
        }

        async function initHub() {
            setInterval(tick, 1000);
            tick();
            
            // Weather
            try {
                const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=25.14&longitude=55.37&current=temperature_2m,weather_code&hourly=temperature_2m,weather_code&timezone=auto');
                const d = await res.json();
                const iconMap = (c) => `https://openweathermap.org/img/wn/${c <= 3 ? '01d' : '03d'}.png`;
                
                document.getElementById('w-temp').innerText = `${Math.round(d.current.temperature_2m)}¬∞C`;
                document.getElementById('w-icon').src = iconMap(d.current.weather_code);
                document.getElementById('hourly').innerHTML = d.hourly.time.slice(0, 10).map((t, i) => `
                    <div class="hourly-item">
                        <div style="opacity:0.5;">${t.split('T')[1]}</div>
                        <img src="${iconMap(d.hourly.weather_code[i])}" style="width:30px;">
                        <div>${Math.round(d.hourly.temperature_2m[i])}¬∞</div>
                    </div>
                `).join('');
            } catch(e) {}

            // Battery
            if(navigator.getBattery) {
                const b = await navigator.getBattery();
                const u = () => document.getElementById('bat').innerText = `${Math.round(b.level * 100)}% ${b.charging ? '‚ö°' : 'üîã'}`;
                u(); b.onlevelchange = u; b.onchargingchange = u;
            }
        }

        window.onload = checkAuth;
    </script>
</body>
</html>
