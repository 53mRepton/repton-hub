<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repton Pro Hub</title>
    <style>
        :root { --glass: rgba(255, 255, 255, 0.1); --accent: #ffcc00; --navy: #0a192f; --warn: #ff4444; --green: #2ecc71; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; }
        body { background: var(--navy); color: white; min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 15px; overflow-x: hidden; }

        /* Screens */
        #login-screen, #settings-screen { position: fixed; inset: 0; background: var(--navy); z-index: 1000; display: flex; align-items: center; justify-content: center; }
        #settings-screen { display: none; overflow-y: auto; padding: 20px; z-index: 900; }
        #hub-ui { display: none; width: 100%; max-width: 450px; animation: fadeIn 0.5s ease; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* UI Components */
        .card { background: var(--glass); backdrop-filter: blur(20px); border-radius: 25px; padding: 22px; border: 1px solid rgba(255,255,255,0.15); margin-bottom: 15px; position: relative; }
        .status-bar { display: flex; justify-content: space-between; font-size: 11px; font-weight: 900; opacity: 0.6; margin-bottom: 8px; letter-spacing: 1px; width: 100%; max-width: 450px; }
        
        /* Progress Bar */
        .progress-track { background: rgba(255,255,255,0.1); height: 8px; border-radius: 10px; margin: 15px 0; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--accent); width: 0%; transition: 0.5s ease-in-out; }

        /* Weather Styles */
        .weather-grid-hourly { display: flex; overflow-x: auto; gap: 15px; padding-bottom: 10px; scrollbar-width: none; }
        .hourly-item { text-align: center; min-width: 50px; font-size: 12px; }
        .hourly-item img { width: 35px; }
        
        .daily-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .daily-row:last-child { border: none; }
        .weather-icon-main { width: 80px; height: 80px; position: absolute; right: 10px; top: 10px; }

        /* Timetable in Settings */
        table { width: 100%; border-collapse: collapse; }
        td { padding: 12px 5px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .tt-input { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: white; width: 100%; padding: 8px; border-radius: 8px; outline: none; }

        /* Buttons */
        .btn { width: 100%; padding: 16px; border-radius: 18px; border: none; font-weight: 800; cursor: pointer; transition: 0.2s; }
        .btn-primary { background: var(--accent); color: var(--navy); }
        .btn-ghost { background: transparent; color: white; border: 1px solid rgba(255,255,255,0.2); }
        .btn:active { transform: scale(0.97); }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="card" style="width: 350px; text-align: center;">
            <h1 style="color: var(--accent); letter-spacing: 2px; margin-bottom: 10px;">REPTON PRO</h1>
            <input type="text" id="nameInput" placeholder="Enter Your Name" style="width:100%; padding:15px; margin-bottom:20px; border-radius:12px; border:none; text-align:center;">
            <button class="btn btn-primary" onclick="login()">ENTER HUB</button>
        </div>
    </div>

    <div id="settings-screen">
        <div class="card" style="width: 100%; max-width: 400px;">
            <h2 style="margin-bottom: 20px;">Edit Timetable</h2>
            <table id="settings-tt-table"></table>
            <button class="btn btn-primary" style="background: var(--green); margin-top: 20px;" onclick="saveData()">SAVE CHANGES</button>
            <button class="btn btn-ghost" style="margin-top: 10px;" onclick="closeSettings()">CLOSE</button>
        </div>
    </div>

    <div id="hub-ui">
        <div class="status-bar">
            <span id="clock">00:00:00</span>
            <span id="bat">--% üîã</span>
        </div>

        <div class="card">
            <h2 id="greet">Hello</h2>
            <div id="current-lesson" style="font-size: 26px; font-weight: 800; margin: 8px 0;">School's Out ‚ú®</div>
            <div id="countdown" style="font-size: 11px; font-weight: 900; color: var(--accent);">WAITING...</div>
            <div class="progress-track"><div id="bar" class="progress-fill"></div></div>
            <button class="btn btn-ghost" style="padding: 10px; font-size: 12px; border-radius: 10px;" onclick="openSettings()">‚öôÔ∏è EDIT TIMETABLE</button>
        </div>

        <div class="card" id="weather-card">
            <img id="w-icon-main" class="weather-icon-main" src="" alt="">
            <div style="font-size: 12px; font-weight: 900; color: var(--accent);">DUBAI WEATHER</div>
            <div id="w-temp" style="font-size: 40px; font-weight: 800;">--¬∞C</div>
            <div id="w-desc" style="text-transform: capitalize; opacity: 0.7; margin-bottom: 15px;">Loading forecast...</div>
            
            <p style="font-size: 10px; font-weight: 900; margin-bottom: 10px; opacity: 0.5;">HOURLY FORECAST</p>
            <div class="weather-grid-hourly" id="hourly-forecast"></div>

            <hr style="opacity: 0.1; margin: 15px 0;">
            
            <p style="font-size: 10px; font-weight: 900; margin-bottom: 10px; opacity: 0.5;">7-DAY FORECAST</p>
            <div id="daily-forecast"></div>
        </div>

        <button class="btn" style="background:transparent; color:var(--warn); margin-top: 10px; opacity: 0.5;" onclick="logout()">LOGOUT</button>
    </div>

    <script>
        let user = "";
        let subjects = ["Maths", "English", "Science", "Break", "History", "Arabic", "Lunch", "PE", "ICT"];
        const times = ["08:00", "09:00", "10:00", "11:00", "11:20", "12:20", "13:20", "14:00", "15:00"];
        const endTimes = ["09:00", "10:00", "11:00", "11:20", "12:20", "13:20", "14:00", "15:00", "16:00"];

        function login() {
            const name = document.getElementById('nameInput').value.trim();
            if(!name) return;
            user = name;
            localStorage.setItem('repton_last_user', name);
            const saved = localStorage.getItem(`tt_${user}`);
            if(saved) subjects = JSON.parse(saved);
            
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('hub-ui').style.display = 'block';
            tick();
            startAll();
        }

        function openSettings() {
            const table = document.getElementById('settings-tt-table');
            table.innerHTML = subjects.map((s, i) => `
                <tr>
                    <td style="font-size:11px; opacity:0.5;">${times[i]}</td>
                    <td><input class="tt-input" value="${s}" id="edit-s-${i}"></td>
                </tr>
            `).join('');
            document.getElementById('settings-screen').style.display = 'flex';
        }

        function saveData() {
            subjects = subjects.map((_, i) => document.getElementById(`edit-s-${i}`).value);
            localStorage.setItem(`tt_${user}`, JSON.stringify(subjects));
            closeSettings();
        }

        function closeSettings() { document.getElementById('settings-screen').style.display = 'none'; }
        function logout() { localStorage.removeItem('repton_last_user'); location.reload(); }

        function tick() {
            const now = new Date();
            const hour = now.getHours();
            const day = now.getDay();
            const nowMins = hour * 60 + now.getMinutes();
            
            document.getElementById('clock').innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
            
            let greet = (hour < 12) ? "Good Morning" : (hour < 17) ? "Good Afternoon" : "Good Evening";
            document.getElementById('greet').innerText = (day === 0 || day === 6) ? `Happy Weekend, ${user}! üèñÔ∏è` : `${greet}, ${user}!`;

            let current = "School's Out ‚ú®", progress = 0, countText = "SEE YOU TOMORROW";
            subjects.forEach((s, i) => {
                const start = parseInt(times[i].split(':')[0])*60 + parseInt(times[i].split(':')[1]);
                const end = parseInt(endTimes[i].split(':')[0])*60 + parseInt(endTimes[i].split(':')[1]);
                if(nowMins >= start && nowMins < end) {
                    current = s;
                    progress = ((nowMins - start) / (end - start)) * 100;
                    countText = `${end - nowMins} MINS REMAINING`;
                }
            });
            document.getElementById('current-lesson').innerText = current;
            document.getElementById('bar').style.width = progress + "%";
            document.getElementById('countdown').innerText = countText;
        }

        async function fetchWeather() {
            try {
                // Using Open-Meteo for data but formatting it for OWM Icons
                const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=25.14&longitude=55.37&current=temperature_2m,relative_humidity_2m,weather_code&hourly=temperature_2m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto');
                const d = await res.json();

                // Simple mapper from WMO codes to OWM Icon IDs
                const getWIcon = (code) => {
                    if (code <= 1) return "01d"; // Clear
                    if (code <= 3) return "02d"; // Clouds
                    if (code <= 48) return "50d"; // Fog
                    if (code <= 67) return "09d"; // Drizzle/Rain
                    if (code <= 82) return "10d"; // Showers
                    if (code <= 99) return "11d"; // Storm
                    return "03d";
                };

                // Update Current
                document.getElementById('w-temp').innerText = `${Math.round(d.current.temperature_2m)}¬∞C`;
                document.getElementById('w-icon-main').src = `https://openweathermap.org/img/wn/${getWIcon(d.current.weather_code)}@2x.png`;
                document.getElementById('w-desc').innerText = "Clear Skies in Dubai"; // Generic or map code to string

                // Update Hourly
                const hourlyCont = document.getElementById('hourly-forecast');
                hourlyCont.innerHTML = d.hourly.time.slice(0, 24).map((t, i) => `
                    <div class="hourly-item">
                        <div>${t.split('T')[1]}</div>
                        <img src="https://openweathermap.org/img/wn/${getWIcon(d.hourly.weather_code[i])}.png">
                        <div>${Math.round(d.hourly.temperature_2m[i])}¬∞</div>
                    </div>
                `).join('');

                // Update Daily
                const dailyCont = document.getElementById('daily-forecast');
                const days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
                dailyCont.innerHTML = d.daily.time.map((t, i) => {
                    const date = new Date(t);
                    return `
                    <div class="daily-row">
                        <span style="width: 50px;">${days[date.getDay()]}</span>
                        <img src="https://openweathermap.org/img/wn/${getWIcon(d.daily.weather_code[i])}.png" style="width:30px;">
                        <span style="opacity:0.6; font-size:12px;">${Math.round(d.daily.temperature_2m_min[i])}¬∞ / <b>${Math.round(d.daily.temperature_2m_max[i])}¬∞</b></span>
                    </div>`;
                }).join('');

            } catch(e) { console.log("Weather error", e); }
        }

        async function startAll() {
            setInterval(tick, 1000);
            tick();
            fetchWeather();
            // Battery logic
            if(navigator.getBattery) {
                const b = await navigator.getBattery();
                const u = () => {
                    const l = Math.round(b.level * 100);
                    document.getElementById('bat').innerText = `${l}% ${b.charging ? '‚ö°' : 'üîã'}`;
                };
                u(); b.onlevelchange = u; b.onchargingchange = u;
            }
        }

        window.onload = () => {
            const last = localStorage.getItem('repton_last_user');
            if(last) { document.getElementById('nameInput').value = last; login(); }
        }
    </script>
</body>
</html>
